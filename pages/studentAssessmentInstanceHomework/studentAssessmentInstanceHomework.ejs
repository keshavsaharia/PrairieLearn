<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/head'); %>
  </head>
  <body>
    <script>
      $(function () {
          $('[data-toggle="popover"]').popover()
      });
    </script>
    <%- include('../partials/navbar', { navPage: 'assessment_instance' }); %>
    <div id="content" class="container">
      <div class="card">
        <h3 class="card-header">
          <span class="pull-right" style="width:5em;">

            <small class="text-center text-muted"
                   style="font-size:24px;display:block;padding-bottom:10px;">
              <%= assessment_instance.points %> / <%= assessment_instance.max_points %>
            </small>
            <%- include('../partials/scorebar', {score: assessment_instance.score_perc}) %>
          </span>
          <%= assessment_set.abbreviation %>
          <%= assessment.number %>: <%= assessment.title %>
          <br>
          <button class="btn btn-outline-success btn-xs btn-click"
                  data-toggle="modal" data-target="#instructionModal">
                  Instructions
          </button>
          <button class="btn btn-link text-secondary btn-xs" disabled>
            <%= authz_result.credit_date_string %>
            available credit</button>
          <%- include('../partials/studentAccessRulesPopover', {
              accessRules: authz_result.access_rules,
              assessmentSetName: assessment_set.name,
              assessmentNumber: assessment.number,
          }) %>
        </h3>

        <div class="modal fade" id="instructionModal" tabindex="-1" role="dialog">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Instructions</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <table>
                  <thead style="opacity:0">
                    <tr><td style="width:40px"></td><td></td></tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="text-primary"><i class="fa fa-list-ol"></i></td>
                      <td>Answer questions in any order.</td>
                    </tr>
                    <tr>
                      <td class="text-primary"><i class="fa fa-repeat"></i></td>
                      <td>Questions can be repeated.</td>
                    </tr>
                    <tr>
                      <td class="text-primary"><i class="fa fa-tasks"></i></td>
                      <td>Not all questions must be completed.</td>
                    </tr>
                    <tr><td colspan="2"><hr></td></tr>
                    <tr>
                      <td class="text-success"><i class="fa fa-check-circle"></i></td>
                      <td>
                        Answering a question correctly will increase
                        your score by its current value<%= (assessment.constant_question_value ? '.' :
                          ', and will also increase its value.') %>
                      </td>
                    </tr>
                    <tr>
                      <td class="text-secondary"><i class="fa fa-plus-circle"></i></td>
                      <td>Your total score is the sum of all question points you have earned.</td>
                    </tr>
                    <tr>
                      <td class="text-danger"><i class="fa fa-times-circle"></i></td>
                      <td>Answering a question incorrectly will reset its value.</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="modal-footer">
                <button type="button" data-dismiss="modal" class="btn btn-primary">Got it</button>
              </div>
            </div>
          </div>
        </div>


        <table class="table table-condensed table-hover no-margin">
          <thead>
            <tr>
              <th>Question</th>
              <th class="cell-center">Value</th>
              <th class="cell-center">History</th>
              <th class="cell-center">Awarded points</th>
            </tr>
          </thead>
          <tbody>
            <% questions.forEach(function(question) { %>
            <% if (question.start_new_zone && question.zone_title) { %>
            <tr>
              <th colspan="3"><%= question.zone_title %></th>
            </tr>
            <% } %>
            <tr>
              <td>
                <span class="badge badge-pill badge-primary">
                  <%= question.question_number %>
                </span>
                <a href="<%= urlPrefix %>/instance_question/<%= question.id %>/">
                  <%= question.question_title %>
                </a>
              </td>
              <td class="cell-center"><%- include('../partials/questionValue', {value: question.current_value});  %></td>
              <td class="cell-center"><%- include('../partials/questionAwardedPoints', {awarded_points: question.variants_points_list, init_points: question.init_points});  %></td>
              <td class="cell-center"><%- include('../partials/questionPointsOfMax', {points: question.points, max_points: question.max_points}); %></td>
            </tr>
            <% }); %>
          </tbody>
        </table>

      </div>
    </div>
  </body>
</html>
